current: all


# the ZEXY-EXTERNAL-makefile
# everything is GnuGPL that should come with the zexy.tgz
# NO WARRANTIES FOR ANYTHING
# et cetera
# 1999:forum::für::umläute:2001

# make sure that the "m_pd.h" is somehow available either by putting it into this
# directory, by adding it's path to the INCLUDE-path or by putting it into an
# already included path, e.g. "/usr/local/include/"

#these are the user adjustables : adjust them to fit into your system
# PD will install to $(DESTDIR)$(INSTALLL_PREFIX)$(PDLIBDIR), which is /usr/local/lib/pd
# by default
DESTDIR =
INSTALL_PREFIX = /usr/local
PDLIBDIR = /pd
#these were the user adjustables


TARGETS = zexy \
	z_connective z_pack z_multiplex z_drip \
	z_makesymbol z_strings \
	z_index z_msgfile \
	z_stat z_average z_sort \
	z_tabread4 z_coordinates \
	z_datetime z_lp \
	z_matrix \
	z_noise z_testfun \
	z_multiline z_sigmatrix \
	z_nop z_zdelay \
	z_limiter z_quantize z_swap \
	z_sigbin z_sigaverage \
	z_dfreq z_sigzero z_pdf \
	z_sfplay z_sfrecord \
	z_sigpack \
	z_down z_prime z_random

# ----------------------- MACOSX ----------------------------
.SUFFIXES: .pd_darwin


LINUXOBJECTS = $(TARGETS:%=%.o)
ARCH = $(shell uname --machine)

PD_DIR = $(DESTDIR)$(INSTALL_PREFIX)$(PDLIBDIR)

ifeq (${ARCH},alpha)
AFLAGS = -mieee  -mcpu=ev56
endif

LINCLUDE =

$(LINUXOBJECTS): *.h

CFLAGS = -O2 -DMACOSX -Dunix -g -Wall-W -Wno-unused \
	 -Wno-parentheses -Wno-switch $(LINCLUDE) $(UCFLAGS) $(AFLAGS)

everything: clean all install distclean

distclean:
	touch dummy.o
	touch dummy.pd_darwin
	touch dummy~
	touch _dummy
	rm *.o *.pd_darwin *~ _*

clean:
	touch dummy.o
	touch dummy.pd_darwin
	rm *.o *.pd_darwin

all: $(LINUXOBJECTS)

	@echo :: $(LINUXOBJECTS)

	cc -bundle -undefined suppress  -flat_namespace -o zexy.pd_darwin *.o -lc -lm
#	strip -x zexy.pd_darwin

.c.pd_darwin:
	cc $(CFLAGS) -DPD  $(INCLUDE) -c -o $*.o $*.c


install: installdocs
	install -m 644 zexy.pd_darwin $(PD_DIR)/extra

installdocs:
	install -d $(PD_DIR)/doc/5.reference/zexy
	install -m644 ../examples/*.* $(PD_DIR)/doc/5.reference/zexy

darwin_package: all
	test -d ../installroot/doc/5.reference || mkdir -p ../installroot/doc/5.reference
	-cp  ../examples/* ../installroot/doc/5.reference
	test -d ../installroot/extra || mkdir -p ../installroot/extra
	install -m644 *.pd_darwin ../installroot/extra
	open ../darwin_package.pmsp

darwin_altpackage: all
	test -d ../installroot/Help || mkdir -p ../installroot/Help
	-cp ../examples/* ../installroot/Help
	test -d ../installroot/Externals || mkdir -p ../installroot/Externals
	install -m644 *.pd_darwin ../installroot/Externals
	open ../darwin_altpackage.pmsp

